
<html>
<head>
    <meta charset="utf-8">
    <title>Message With Reply</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0">
    <style>
		*{
			padding:0;
			margin:0;
		}
		header{
			position:sticky;
			top:0;
			background-color:#03A9F4;
			color:white;
			text-align:center;
			padding:8px;
			z-index:99;
		}
		footer{
			display:flex;
			width:100%;
			background-color:#ddd;
			position:fixed;
			bottom:0;
			height:48px;
		}
		.bubble{
			display:inline-block;
			position:relative;
			padding: 8px;
			font-size: 14px;
			background-color: #fff;
			margin-top: 20px;
			border-radius:4px;
			max-width:200px;
			font-weight: 400;
			word-wrap: break-word;
			word-break: normal;
		}
		.bubble::before,.bubble::after{
			content: '';
			position: absolute;
			width: 0;
			height: 0;
			top: 11px;
		}
		.left .bubble{
			left: 15px;
			border: 1px solid #d5d5d5;
		}
		.left .bubble::before{
			border-right: 10px solid #d5d5d5;
			border-top: 6px solid transparent;
			border-bottom: 6px solid transparent;
			left: -10px;
		}
		.left .bubble::after{
			border-right: 10px solid #fff;
			border-top: 6px solid transparent;
			border-bottom: 6px solid transparent;
			left: -8px;
		}
		.right .bubble{
			right: 15px;
			background-color: #3c9;
			border: 1px solid #009688;
			color:white;
		}
		.right .bubble::before{
			border-left: 10px solid #009688;
			border-top: 6px solid transparent;
			border-bottom: 6px solid transparent;
			right: -10px;
		}
		.right .bubble::after{
			border-left: 10px solid #3c9;
			border-top: 6px solid transparent;
			border-bottom: 6px solid transparent;
			right: -8px;
		}
		.message{
			clear:both;
			display:flex;
			padding: 4px 10px;
		}
		.message.right{
			align-content: end;
			flex-direction: row-reverse;
		}
		.avartar{
			width:48px;
			height:48px;
			border-radius:50%;
		}
		.message.right span{
			position:absolute;
			right:74px;
			font-size: 14px;
		}
		.message.left span{
			position:absolute;
			left:74px;
			font-size: 14px;
		}
		.input-text {
            flex-grow: 1;
            border: deepskyblue 1px solid;
            padding: 4px;
            border-radius: 50px;
            text-indent: 6px;
            margin: 6px 4px;
        }

        .input-text:focus,
        .input-text:active {
            border: yellowgreen 1px solid;
            outline: none;
        }

        .btn {
            padding: 2px 4px;
            border-radius: 30px;
            border: deepskyblue 1px solid;
            background: linear-gradient(deepskyblue, dodgerblue);
            color: white;
			font-size:12px;
            width: 55px;
            margin: 6px 4px;
        }

        .btn:focus {
            border: dodgerblue 1px solid;
            outline: none;
        }

        .btn:active {
            border: dodgerblue 1px solid;
            background: linear-gradient(dodgerblue, deepskyblue);
            outline: none;
        }
    </style>
</head>
<body>
<header>MwrChat</header>
<div id="msg_comtainer">
</div>
<footer>
	<label for="txt_msg"></label><input class="input-text" type="text" id="txt_msg" placeholder="">
	<button class="btn" id="btn_send">发送</button>
</footer>
<script type="text/javascript">
    'use strict';
	let msg_comtainer = document.getElementById('msg_comtainer');
	let txt_msg = document.getElementById('txt_msg');
	
	function appendMsg(msg,pos){
		let message = document.createElement('div');
		message.classList.add('message', pos);
		message.innerHTML = `<span>${msg.username}</span><img class="avartar" src="https://api.adorable.io/avatars/48/${msg.username}"/><div class="bubble">${msg.content}</div>`;
		msg_comtainer.append(message);
	}
	
	function SimpleChat(username,room){
		let rid = room || 1;
		let socket = new WebSocket("wss://connect.websocket.in/simple_chat?room_id="+rid);
		socket.onmessage = function(e){
			let msg = JSON.parse(e.data);
			appendMsg(msg,"left");
		};
		return {
			send:function(content){
				let msg = {username:username,content:content};
				appendMsg(msg,"right");
				socket.send(JSON.stringify(msg));
			}
		}
	}
	
	let chat = SimpleChat(prompt("输入用户名",""));
	
	document.getElementById('btn_send').addEventListener('click', _ => {
		chat.send(txt_msg.value);
		txt_msg.value = "";
	});
</script>
</body>
</html>
